{% extends "base.html" %}

{% block title %}YouTube Highlights{% endblock %}

{% block content %}
<div class="hero">
    <h1>YouTube Highlight Editor</h1>
    <p class="subtitle">Paste a YouTube URL to watch and mark the best moments</p>
</div>

<div class="card" id="input-card">
    <h2>Enter YouTube Video</h2>

    <form id="youtube-form">
        <div class="form-group">
            <label for="youtube-url">YouTube URL:</label>
            <input type="text" id="youtube-url" name="url"
                   placeholder="https://www.youtube.com/watch?v=..."
                   class="input-text input-large"
                   autofocus>
        </div>
        <button type="submit" class="btn btn-primary btn-block" id="youtube-btn">
            Go
        </button>
    </form>
    <p class="hint">Paste a YouTube URL (supports youtube.com/watch?v=, youtu.be/, etc.)</p>
</div>

<style>
.input-large {
    font-size: 1.1rem;
    padding: 0.75rem 1rem;
}
</style>
{% endblock %}

{% block scripts %}
<script>
const youtubeForm = document.getElementById('youtube-form');
const youtubeUrl = document.getElementById('youtube-url');
const youtubeBtn = document.getElementById('youtube-btn');

youtubeForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const url = youtubeUrl.value.trim();
    if (!url) return;

    // Extract video ID client-side
    const videoId = extractVideoId(url);
    if (!videoId) {
        youtubeUrl.setCustomValidity('Invalid YouTube URL');
        youtubeUrl.reportValidity();
        return;
    }

    // Navigate directly to /watch?v=<id>
    window.location.href = `/watch?v=${videoId}`;
});

function extractVideoId(url) {
    // Match various YouTube URL formats
    const patterns = [
        /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)([a-zA-Z0-9_-]{11})/,
        /^([a-zA-Z0-9_-]{11})$/,  // bare video ID
    ];
    for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) return match[1];
    }
    return null;
}
</script>
{% endblock %}
