<!DOCTYPE html>
<html lang="en" class="watch-page">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Watch - YouTube Highlights</title>
    <link rel="stylesheet" href="css/style.css?v=0.4.1">
</head>
<body data-mode="watch">
    <nav class="navbar">
        <a href="index.html" class="nav-brand">
            <span class="logo">üé¨</span>
            <span>YouTube Highlights</span>
        </a>
        <div class="nav-links">
            <button id="nav-fs-btn" class="btn btn-edit-mode watch-only" onclick="toggleFullscreen()" title="Fullscreen (f)">&#x26F6; Fullscreen</button>
            <button id="nav-save-btn" class="btn btn-save edit-only" onclick="saveEdits()">Save</button>
            <button id="nav-export-btn" class="btn btn-export edit-only" onclick="openExportModal()">Export</button>
            <button id="nav-cancel-btn" class="btn btn-cancel edit-only" onclick="cancelEdits()">Cancel</button>
        </div>
    </nav>

    <main class="container">
        <!-- Loading State -->
        <div id="loading-state" class="card" style="text-align: center; padding: 3rem;">
            <div class="spinner" style="margin: 0 auto 1rem;"></div>
            <p>Loading video info...</p>
        </div>

        <!-- Error State -->
        <div id="error-state" class="watch-error hidden">
            <h2>Error</h2>
            <p id="error-message"></p>
            <a href="index.html" class="btn btn-primary">Back to Home</a>
        </div>

        <!-- Main Layout (hidden until loaded) -->
        <div class="editor-layout hidden" id="editor-layout">
            <!-- Fullscreen Container -->
            <div id="fullscreen-container" class="fullscreen-container">
                <!-- Video Player Section -->
                <div class="video-section" id="video-pane">
                    <div id="youtube-player-container">
                        <div id="youtube-player"></div>
                        <div id="fs-click-capture" class="fs-click-capture"></div>
                    </div>
                    <div class="video-controls">
                        <div class="time-display">
                            <span id="current-time">00:00.00</span>
                            <span class="time-separator">/</span>
                            <span id="total-time">00:00.00</span>
                        </div>
                    </div>
                </div>
                <!-- Fullscreen overlay (hidden unless fullscreen) -->
                <div id="fs-overlay" class="fs-overlay">
                    <div class="fs-overlay-top">
                        <span id="fs-clip-indicator" class="fs-clip-indicator"></span>
                        <button class="fs-btn" onclick="exitFullscreen()" title="Exit fullscreen">&#x2715;</button>
                    </div>
                    <div class="fs-overlay-bottom">
                        <button id="fs-play-stop-btn" class="fs-btn" onclick="togglePlayAll()">Play</button>
                        <div class="fs-progress-bar" id="fs-progress-bar">
                            <div id="fs-progress-fill" class="fs-progress-fill"></div>
                        </div>
                        <span id="fs-time-display" class="fs-time-display">0:00</span>
                    </div>
                </div>
            </div>

            <!-- Draggable Splitter -->
            <div class="splitter" id="splitter"></div>

            <!-- Highlights List Section - right sidebar -->
            <div class="highlights-section" id="highlights-pane">
                <div class="highlights-header">
                    <h3>Highlights <span id="highlight-count">(0)</span></h3>
                    <div class="highlights-total">
                        Total: <span id="total-duration">0:00</span>
                    </div>
                </div>
                <div id="highlights-list" class="highlights-list">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Empty State Overlay (shown when watch mode + 0 highlights) -->
        <div class="empty-overlay hidden" id="empty-overlay">
            <div class="empty-overlay-content">
                <h2>No highlights found for this video</h2>
                <p>The video description doesn't contain any highlights.</p>
                <button class="btn btn-primary btn-large" onclick="enterEditMode()">Enter Edit Mode</button>
            </div>
        </div>
    </main>

    <!-- Timeline Section - fixed at bottom -->
    <div class="timeline-section hidden" id="timeline-section">
        <div class="timeline-header">
            <div class="timeline-header-left">
                <span class="timeline-stats" id="timeline-stats">0 highlights (0:00)</span>
                <button id="play-stop-btn" class="btn btn-primary btn-sm" onclick="togglePlayAll()">Play</button>
                <button id="timeline-edit-btn" class="btn btn-sm btn-edit-mode watch-only" onclick="enterEditMode()">Edit</button>
                <label class="preview-toggle edit-only" title="Loop through highlights like watch mode">
                    <input type="checkbox" id="preview-checkbox" onchange="togglePreview(this.checked)">
                    Preview
                </label>
            </div>
            <div class="timeline-info">
                <span id="timeline-zoom-label">Full length</span>
                <span id="timeline-duration">Duration: 0:00</span>
            </div>
        </div>
        <div class="timeline-scroll-container" id="timeline-scroll">
            <div class="timeline-content" id="timeline-content">
                <div class="timeline-wrapper">
                    <div id="timeline" class="timeline-bar">
                        <!-- Highlight segments populated by JS -->
                    </div>
                    <div id="playhead" class="playhead">
                        <div class="playhead-handle"></div>
                    </div>
                </div>
                <div id="time-labels" class="time-labels"></div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Toggle -->
    <button class="shortcuts-toggle hidden" id="shortcuts-toggle" onclick="toggleShortcuts()" title="Keyboard Shortcuts">?</button>
    <div class="shortcuts-help hidden" id="shortcuts-help">
        <h4>Keyboard Shortcuts</h4>
        <div class="shortcuts-grid">
            <div><kbd>[</kbd></div><div>Set highlight start <span class="edit-only-label">(edit)</span></div>
            <div><kbd>]</kbd></div><div>Set highlight end <span class="edit-only-label">(edit)</span></div>
            <div><kbd>\</kbd></div><div>Cancel highlight start <span class="edit-only-label">(edit)</span></div>
            <div><kbd>‚Üê</kbd> <kbd>‚Üí</kbd></div><div>Jump ¬±5 seconds</div>
            <div><kbd>z</kbd> <kbd>x</kbd></div><div>Jump ¬±2 seconds</div>
            <div><kbd>‚Üë</kbd> <kbd>‚Üì</kbd></div><div>Prev / Next highlight</div>
            <div><kbd>‚åò</kbd><kbd>‚Üë</kbd> <kbd>‚åò</kbd><kbd>‚Üì</kbd></div><div>First / Last highlight</div>
            <div><kbd>Space</kbd></div><div>Play / Pause</div>
            <div><kbd>d</kbd></div><div>Speed +0.1x</div>
            <div><kbd>s</kbd></div><div>Speed ‚àí0.1x</div>
            <div><kbd>r</kbd></div><div>Toggle 1x / 2x</div>
            <div><kbd>t</kbd></div><div>Cycle timeline: hide / full / zoom</div>
            <div><kbd>f</kbd></div><div>Toggle fullscreen</div>
            <div><kbd>h</kbd></div><div>Toggle highlights panel</div>
            <div><kbd>Delete</kbd></div><div>Delete selected <span class="edit-only-label">(edit)</span></div>
            <div><kbd>e</kbd></div><div>Enter Edit mode</div>
            <div><kbd>Escape</kbd></div><div>Back to Watch / Deselect</div>
        </div>
    </div>

    <!-- Highlights Tab (visible when panel hidden) -->
    <button class="highlights-tab hidden" id="highlights-tab" onclick="toggleHighlightsPanel()">
        Highlights (<span id="tab-highlight-count">0</span>)
    </button>

    <!-- Export Modal -->
    <div class="modal-overlay hidden" id="export-modal" onclick="if(event.target===this)closeExportModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Highlights</h3>
                <button class="modal-close" onclick="closeExportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <a id="export-watch-url" href="#" target="_blank" class="export-url"></a>
                <textarea id="export-textarea" class="export-textarea" readonly rows="10"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="copyExportText()">Copy to Clipboard</button>
                <button class="btn btn-secondary" onclick="closeExportModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast"></div>

    <script src="js/config.js?v=0.4.1"></script>
    <script src="js/app.js?v=0.4.1"></script>
</body>
</html>
